<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/login/styles.css"/>
    <link
      href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css"
      rel="stylesheet"
    />
    <title>User Messages</title>
    
  </head>
  <body>
    <section class="header">
      <div class="logo">
        <!-- <i class="ri-menu-line icon icon-0 menu"></i> -->
        <h1>MY<span>BRAND</span></h1>
      </div>
    </section>
    <section class="main">
      <div class="sidebar">
        <ul class="sidebar--items">
          <li>
            <a href="./dash.html">
      
              <span class="sidebar--item">Dashboard</span>
            </a>
          </li>
          <!-- <li>
            <a href="#">
              <span class="icon icon-2"><i class="ri-line-chart-line"></i></span>
              <span class="sidebar--item">Edit Portfolio</span>
            </a>
          </li> -->
          <li>
            <a href="./usermessage.html" id="active--link user-queries">
              <!-- <span class="icon icon-4"><i class="ri-line-chart-line"></i></span> -->
              <span class="sidebar--item">User messages</span>
            </a>
          </li>
          <!-- <li>
            <a href="">
              <span class="icon icon-3"><i class="ri-line-chart-line"></i></span>
              <span class="sidebar--item">Add Skills</span>
            </a>
          </li> -->
          <li>
            <a href="./addblog.html">
              <!-- <span class="icon icon-4"><i class="ri-line-chart-line"></i></span> -->
              <span class="sidebar--item">Add Blog</span>
            </a>
          </li>
        </ul>
        <ul class="sidebar--bottom-items">
          
          <li>
            <a href="../index.html">
              <span class="icon icon-5"
                ><i class="ri-logout-box-r-line"></i
              ></span>
              <span class="sidebar--item">Logout</span>
            </a>
          </li>
        </ul>
      </div>
      <!-- blogs -->
      <h2 class="h2">Blogs</h2>
      <div id="blog-ta">
      <table id="blogs-table">
          <tr>
              <th>Title</th>
              <th>Author</th>
              <th class="pic">PublishedDate</th>
              <th>Introduction</th>
              <th class="pic">Image</th>
              <th>Action</th>
              
          </tr>
          <!-- Insert Content here using javascript -->
          
      </table>
    </div>
         <div id="no-blog" style="display: none;">
          No blog available....
         </div>  
    
      
    </section>
  

<script>
    
    document.addEventListener("DOMContentLoaded", async() => {
    const blogTable = document.querySelector("#blogs-table tbody");
    const noblogmessage = document.querySelector('#no-blog');
    console.log(noblogmessage);


    try {
      response = await fetch('https://mybrand-backend-v82m.onrender.com/api/v1/blogs',{
        method: 'GET',
        
      });
      if(!response.ok){
        throw new Error(`failed to fetch ${response.status}`);

      }
      const responseData = await response.json();
      console.log('response data:', responseData);
      if(responseData.allblogs.length === 0){
        noblogmessage.style.display = "block";
      } else {
        noblogmessage.style.display = "none";
      

      responseData.allblogs.forEach((blog)=>{
        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${blog.title}</td>
            <td>${blog.author}</td>
            <td class="pic">${new Date(blog.publishedDate).toLocaleDateString('en-US')}</td>
            <td>${blog.introduction}</td>
            <td class="pic">
                <img src="https://mybrand-backend-v82m.onrender.com/uploads/${blog.image}" alt="" style="height:200px;width:100px">

            </td>
            <td>
                 
                <button id="delete" style="background-color:blue;color:white;padding:6px;margin-left:25px;" onclick="navigateToEdit('${blog._id}')">Update</button>
                <button id="delete" style="background-color:red;color:white;padding:6px;margin-left:25px;" onclick="deleteBlog('${blog._id}')">Delete</button>
            </td>
            
        `;
        blogTable.appendChild(row);
      })}
    } catch (error) {
        console.error('Error fetching blogs:', error);
        if (response) {
            console.error('Response status:', response.status);
        }
    }
  })
   

    

const deleteBlog = async(id)=>{
  
      try{
        const token = localStorage.getItem('token');
        if(!token){
          console.log("no token found");
        }
          const response = await fetch(`https://mybrand-backend-v82m.onrender.com/api/v1/blogs/${id}`, {
            method: 'DELETE',
            headers: {'Content-Types': "application/json"}
          })

        if(!response.ok)  {
          return ("failed to delete")
        }
        location.reload();


      }catch(error){
        console.log(error);
      }
}

//function to edit

const navigateToEdit = (id)=>{
  window.location.href = `editBlog.html?id=${id}`;
  
}


</script>
</html>
</body>